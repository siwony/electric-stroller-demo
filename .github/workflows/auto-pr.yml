name: Auto PR from feature.md
on:
  push:
    paths:
      - 'feature.md'
      - 'require.md'

# 1. PR 생성 및 브랜치 푸시를 위한 권한을 추가합니다.
permissions:
  contents: write
  pull-requests: write

jobs:
  copilot-auto-pr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Generate code via Copilot API
        uses: github/copilot-actions@v1
        with:
          prompt: "Implement the features from feature.md and require.md."
          output: "src/generated" # 코드를 'src/generated'에 생성

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          # 2. (권장) 코파일럿이 생성한 파일만 커밋하도록 경로를 지정합니다.
          #    이걸 생략하면 의도치 않은 다른 변경사항도 커밋될 수 있습니다.
          add-paths: 'src/generated'
          
          # 3. (권장) 커밋 작성자 정보를 지정합니다.
          commit-message: "feat: Auto-generate code via Copilot"
          committer: github-actions[bot] <github-actions[bot]@users.noreply.github.com>
          author: github-actions[bot] <github-actions[bot]@users.noreply.github.com>
          
          # 4. (권장) 동일 이름의 브랜치가 이미 존재할 경우, 덮어씁니다.
          #    md 파일이 변경될 때마다 PR이 계속 업데이트됩니다.
          delete-branch: true

          branch: auto/copilot-pr
          title: "Copilot Auto PR - Feature Implementation"
          body: |
            Automatically generated code based on updates to:
            - `feature.md`
            - `require.md`
